# Default values for nussknacker.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: touk/nussknacker
  # By default, the tag is taken from the chart's appVersion, but you can override it with this property.
  # tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: [ ]
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name:

podSecurityContext:
  fsGroup: 1001

securityContext:
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  runAsUser: 1001

service:
  type: ClusterIP
  port: 80

persistence:
  enabled: true
  ## A manually managed Persistent Volume and Claim
  ## If defined, PVC must be created manually before volume will be bound
  ## The value is evaluated as a template, so, for example, the name can depend on .Release or .Chart
  # existingClaim:

  ## The subdirectory of the volume to mount to, useful in dev environments
  ## and one PV for multiple services.
  ##
  subPath: ""

  ## If defined, storageClassName: <storageClass>
  ## If set to "-", storageClassName: "", which disables dynamic provisioning
  ## If undefined (the default) or set to null, no storageClassName spec is
  ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
  ##   GKE, AWS & OpenStack)
  ##
  # storageClass: "-"

  accessMode: ReadWriteOnce
  size: 1Gi
  annotations: { }

ingress:
  enabled: false
  # domain: <a TLD must be set>
  # host: .Release.Name-nussknacker
  # tlsSecretName: .Release.Name-nussknacker-tls

resources: { }
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

nodeSelector: { }

tolerations: [ ]

affinity: { }

db:
  driver: "org.postgresql.Driver"
  url: 'jdbc:postgresql://{{ .Release.Name }}-postgresql/'
  schema: public
  user: postgres
  # password: from a postgresql secret via env variable (see deployment.yaml) by default

nussknacker:
  #override it if you want to provide own config file and ignore one provided via configmap.yaml
  configFile: /etc/nussknacker/application.conf
  modelConfig:
    classPath:
      #Generic NK model
      - "model/genericModel.jar"
  flinkConfig:
    jobManagerTimeout: "1m"
    #Have to be provided if Flink not enabled
    #restUrl:
    #queryableStateProxyUrl:
  uiConfig:
    environment: "default"
    environmentAlert:
      content: "{{ .Values.nussknacker.uiConfig.environment }}"
      cssClass: "indicator-green"
    categoriesConfig:
      #NOTE: all categories have to point to 'default' processType!
      Default: "default"

postgresql:
  enabled: true
  volumePermissions:
    enabled: true

kafka:
  enabled: true
  imageTag: 5.4.2
  testsEnabled: false
  peristence:
    enabled: true
  zookeeper:
    persistence:
      enabled: true
    image:
      tag: 3.6.0

schema-registry:
  enabled: true
  imageTag: 5.4.2
  kafka:
    enabled: false

flink:
  enabled: true
  image:
    tag: 1.11.2-scala_2.12
  taskmanager:
    statefulset: false
    numberOfTaskSlots: 3
  jobmanager:
    statefulset: true
#  prometheus:
#    serviceMonitor:
#      enabled: false

grafana:
  enabled: true
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s/grafana"
      serve_from_sub_path: true
    security:
      allow_embedding: true
    #TODO: just for demo purposes
    "auth.anonymous":
      enabled: true
  #TODO: authentication
  adminUser: admin
  adminPassword: admin
  rbac:
    create: true
    namespaced: true
    pspEnabled: false
  sidecar:
    dashboards:
      enabled: true
    datasources:
      enabled: true
  ingress:
    enabled: false

influxdb:
  enabled: true
  env:
    - name: INFLUXDB_DB
      value: "nussknacker"

telegraf:
  enabled: true
  rbac:
    create: false
  args:
    - "--config-directory"
    - "/etc/telegraf/telegraf.d"
  volumes:
    - name: telegraf-nussknacker
      configMap:
        name: "telegraf-nussknacker"
  mountPoints:
    - name: telegraf-nussknacker
      mountPath: /etc/telegraf/telegraf.d
  config:
    #We suppress default influxDB configuration from chart, as we cannot easily template influxdb url
    outputs: []

hermes:
  enabled: false
  kafka:
    enabled: false
    url: "{{ .Release.Name }}-kafka:9092"
    zookeeper:
      enabled: false
      url: "{{ .Release.Name }}-zookeeper:2181"
    namespace: "{{ .Release.Name }}"
  schema-registry:
    enabled: false
    url: "http://{{ .Release.Name }}-schema-registry:8081"
